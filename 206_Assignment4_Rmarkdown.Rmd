---
title: "Assignment4_ngmrcv"
author: "Nelson Gould, Max Russer, and Ciao Vianna"
date: "11/12/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}

# Load packages and read in data

library(tidyverse)
library(knitr)
library(kableExtra)
library(plotly)
library(extrafont)
library(effsize)
library(vcdExtra)
library(car)

lob_traps <- read_csv("lobster_traps.csv")
lob_size_abun <- read_csv("lobster_size_abundance.csv")


```

```{r, include=FALSE}
# Lobster abundance and fishing pressure (2012 - 2017)

# Describe trends in lobster abundance (counts) and fishing pressure (trap buoys) at the five locations from 2012 - 2017. Ignore transect information - we are only interested in evaluating abundance and pressure on the order of SITE. Note: you are not expected to use regression here - just think of ways to clearly describe annual totals visually and in text, noting important trends, events and differences.


# Here I created summary tables for both abundance (based on average count of lobsters at each transect)

abun_summary <- lob_size_abun %>% 
  group_by(SITE, YEAR) %>%
  summarize(
    Count = sum(COUNT),
    data_type = "Abundance") 

trap_summary <- lob_traps %>% 
  group_by(SITE, YEAR) %>% 
  filter(SITE != "ABUR", SITE != "AHND", SITE != "AHND to AQUE", SITE != "GOLB") %>% 
  summarize(
    Count = sum(TRAPS),
    data_type = "Trap")

# Joining summary tables based on year and site

trap_abun <- full_join(abun_summary, trap_summary) %>% 
  filter(Count != "NA") 

lob_abun_trap_graph <- ggplot(trap_abun,aes(x = YEAR, y = Count)) +
  geom_col(aes(fill = data_type), color = "black", position = "dodge", width = .5) +
  scale_y_continuous(expand = c(0,0)) + 
  facet_wrap(~ trap_abun$SITE) +
  theme_classic() +
  scale_x_continuous(expand = c(0,0)) +
  #theme() +
  xlab(label = "Year") 

lob_abun_trap_graph 

```

```{r}

# Tidy data: expand count data

exp_abun <- lob_size_abun %>% 
  filter(SIZE != "-99999") %>% 
  expand.dft(freq = "COUNT") %>% 
  select("YEAR","SITE","SIZE")
exp_abun

# Lobster size summary table

lob_size_summary <- exp_abun %>% 
  group_by(SITE) %>% 
  summarize(
    mean_size = round(mean(SIZE)),
    sd_size = round(sd(SIZE),1),
    sample_size = length(SITE)
  )

# 

# Exploratory QQ-plots and histograms

hists_size <- ggplot(exp_abun, aes(x = SIZE)) +
  geom_histogram(aes(fill = SITE))
hists_size

qq_size <- ggplot(exp_abun, aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~SITE)
qq_size  

# Data appear normally distributed

# Levene's test for equal variance between sites

var_test_size <- leveneTest(SIZE ~ SITE, data = exp_abun)
var_test_size

# We can reject the null hypothesis that sites have equal size variances

site_size_anova <- exp_abun %>% 
  Anova(lm(SIZE ~ SITE),  type = "II", data = exp_abun, vcov )
site_size_anova


size_graph <- ggplot(lob_size_summary, aes(x = SITE, y = mean_size)) +
  geom_col(fill = "steelblue", color = "black", width = .7) +
  geom_errorbar(aes(ymin=mean_size-sd_size, ymax=mean_size+sd_size), width=.15) +
  theme_classic() +
  scale_x_discrete(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  ylab(label = "Mean Lobster Size (mm)") +
  xlab(label = "Site")

size_graph




```
